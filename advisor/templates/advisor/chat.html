{% extends 'base.html' %}
{% block title %}Chat{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow dharma-chat-card">
            <div class="card-header bg-transparent border-0 d-flex justify-content-between">
                <h4 class="mb-0">Dharma AI Chat</h4>
                <span class="badge bg-warning text-dark">Sanatan Guidance</span>
            </div>

            <div class="card-body chat-body" id="chatBody">

                {% if chat_messages %}
                {% for msg in chat_messages %}

                {% if msg.role == 'user' %}
                <div class="chat-bubble user-bubble">
                    <div class="small text-muted mb-1">You</div>
                    <div>{{ msg.text|linebreaksbr }}</div>
                </div>

                {% else %}
                <div class="chat-bubble ai-bubble">
                    <div class="small text-muted mb-1">Dharma AI</div>
                    <div>{{ msg.text|linebreaksbr }}</div>
                </div>
                {% endif %}

                {% endfor %}

                {% else %}
                <p class="text-light-50">
                    Start by asking anything, for example:<br>
                    <em>"I am confused in my career, what should I do?"</em><br>
                    <em>"How to control anger according to Gita?"</em>
                </p>
                {% endif %}
            </div>
            
            <div class="card-footer bg-transparent border-0">
                <div class="alert alert-warning mb-3">
                        <strong>üôè Usage Notice</strong><br>
                        Dharma AI is powered by the Gemini AI free tier.<br>
                        The application supports a total of <b>20 AI requests per day (shared by all users)</b>.
                        <br><br>
                        Please use it mindfully and avoid excessive or frivolous queries to ensure availability for all
                        users.

                    </div>
                <form method="post" class="d-flex gap-2">
                    {% csrf_token %}
                    
                    <textarea name="message" rows="2" class="form-control"
                        placeholder="Type your question or feelings here..."></textarea>
                    <button type="submit" class="btn btn-warning">Send</button>
                </form>
            </div>

        </div>
    </div>
</div>
{% endblock %}